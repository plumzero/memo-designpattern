
工作中遇到了这样的一种场景。

在编写服务时，要定义和处理不同种类的消息，为此可以为每种消息实现一个处理方法。消息与方法一一对应。

这可以使用工厂模式来实现。

### 侵入式实现

首先需要定义一个抽象类。各子类由抽象类继承派生，同时还要定义对应于每个派生类的标识(这里是 MessageType)。

然后定义工厂类，它包括两个函数，一个是注册函数，一个是根据标识创建出对应派生类的生成函数。

[简单实现示例](intrusive.cpp)

如果需要向派生类中传入参数(比如上下文指针)，可以进行简单的修改。

[带参数实现示例](intrusive_with_paras.cpp)

在上面的实现中，由于每次添加新的消息都需要对工厂类中的注册函数进入追加，所以这种实现是侵入式的。

### 模板实现

可以利用模型进入非侵入实现。

[模板实现实例](template.cpp)

如果需要向派生类中传入参数(比如上下文指针)，可以进行简单的修改。

[带可变参数实现示例](factory.h)

当然，也可以通过抽象工厂模式进入非侵入式实现。

### 工厂保存对象

工厂在创建对象的同时，也顺便可以对这些对象进行管理。在上面简单实现示例的程序基础上稍作改动。

[利用工厂管理对象](intrusive_store.cpp)

可以看到，对比之下就是加了一个数组存储。
